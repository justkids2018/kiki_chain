# 老师查看学生作业列表功能需求

## 角色
你是Flutter 高级开发工程师，具有丰富的DDD架构和GetX状态管理经验

## 功能概述
实现老师端查看和管理其名下学生作业记录的功能模块，包含搜索、筛选、分页和详情查看等核心功能。

## 任务目标

### 1. 核心功能
- **作业记录列表展示**：显示老师名下所有学生的作业完成记录
- **学生姓名搜索**：根据学生姓名进行实时搜索筛选
- **分页加载**：支持20条记录一页的分页展示
- **详情查看**：点击记录可查看详细的作业完成情况

### 2. 展示内容字段
必须展示以下核心信息：
- **学生信息**：学生姓名、手机号
- **作业信息**：作业标题(assignment_title)
- **完成状态**：作业状态(status) - not_started/in_progress/completed/reviewed
- **学习数据**：
  - 对话轮次(dialog_rounds)
  - 知识掌握评分(knowledge_mastery_score) - 0-100分
  - 思维深度评分(thinking_depth_score) - 0-100分
  - 平均思考时间(avg_thinking_time_ms) - 毫秒转换为秒显示
- **时间信息**：开始时间(started_at)、完成时间(completed_at)

### 3. 交互功能
- **搜索筛选**：支持按学生姓名进行模糊搜索
- **状态筛选**：可按作业状态进行筛选
- **排序功能**：支持按完成时间、评分等字段排序
- **下拉刷新**：支持手动刷新数据
- **上拉加载**：自动分页加载更多数据

---

## 已知上下文

### API接口信息
**主要接口**: `GET /api/teachers/{teacher_uid}/student-assignments`
- **认证**: Bearer Token (老师角色)
- **参数**: teacher_uid (当前登录老师的UID)
- **响应**: 嵌套结构 - 学生分组，每个学生包含多个作业记录

**数据结构示例**:
```json
{
  "success": true,
  "data": {
    "teacher_uid": "teacher_001", 
    "students": [
      {
        "student": {
          "uid": "stu_1001",
          "name": "张三",
          "phone": "18800000000",
          "role_id": 3
        },
        "assignments": [
          {
            "student_assignment_id": "cf9e5b4d-6e3f-4fe9-8f1d-3a2b9c1d4f01",
            "assignment_id": "9d0b4b61-4c43-4b54-b7d4-9e5a9e7f1234", 
            "assignment_title": "数学思维练习",
            "status": "completed",
            "dialog_rounds": 5,
            "avg_thinking_time_ms": 1200,
            "knowledge_mastery_score": "95.0",
            "thinking_depth_score": "88.0", 
            "started_at": "2025-09-13T08:00:00Z",
            "completed_at": "2025-09-13T09:00:00Z"
          }
        ]
      }
    ]
  }
}
```

### 现有基础设施
- **网络管理**: RequestManager单例 (已实现JWT认证)
- **状态管理**: GetX框架 (响应式状态管理)
- **用户反馈**: EasyLoading (加载和错误提示)
- **日志系统**: AppLogger (操作日志记录)
- **学生作业模块**: 已实现StudentAssignmentEntity、Repository、Controller

---

## 技术实现规范

### 目录结构规范
所有功能代码需创建在独立目录中：
```
lib/presentation/pages/teacher/teacher_check_assignment/
├── teacher_assignment_check_page.dart          # 主页面
├── teacher_assignment_check_controller.dart    # GetX控制器
├── teacher_assignment_check_repository.dart    # API仓库
├── models/
│   ├── teacher_student_assignment_entity.dart  # 数据实体
│   └── assignment_search_filter.dart           # 搜索筛选模型
└── widgets/
    ├── assignment_record_card.dart             # 作业记录卡片
    ├── student_search_bar.dart                 # 搜索栏组件
    └── assignment_status_filter.dart           # 状态筛选组件
```

### 页面架构设计
**布局结构**：上下两部分垂直布局
- **上部分**: 搜索和筛选区域
  - 学生姓名搜索框 (实时搜索)
  - 作业状态筛选器 (下拉选择)
  - 排序方式选择器
- **下部分**: 作业记录列表
  - 支持下拉刷新
  - 分页加载 (20条/页)
  - 卡片式展示每条记录

### 数据处理逻辑
1. **数据扁平化**: 将嵌套的学生-作业结构扁平化为作业记录列表
2. **本地搜索**: 在前端实现学生姓名的模糊搜索
3. **状态管理**: 使用GetX管理搜索关键词、筛选条件、分页状态
4. **缓存策略**: 实现数据缓存，避免频繁网络请求

### API端点配置
需要在 `lib/core/constants/api_endpoints.dart` 中添加：
```dart
static const String getTeacherStudentAssignments = '/api/teachers/{teacher_uid}/student-assignments';
```

---

## 约束与规范

### 开发架构规范
- **基础开发要求**: 动态读取 `doc/prompt/base_*.md` 规范文件
- **开发指南模板**: 遵循 `doc/framework/新功能开发指南标准_20250916.md`
- **架构约束**: 必须遵循DDD架构模式 (Entity → Repository → Controller → Page)
- **状态管理**: 使用GetX进行响应式状态管理
- **兼容性**: 不修改现有逻辑功能，保持代码一致性

### UI设计规范
- **设计指南**: 遵循 `doc/prompt/ui_prompt_ui.md` 规范
- **设计风格**: "Refined" Liquid Glass设计系统
- **主色调**: Liquid Green (#00C37D)、Light Base (#F8FAFC)
- **卡片设计**: 毛玻璃效果，圆角16px，轻微阴影
- **交互反馈**: 悬停/点击动画效果，加载状态指示器

### 代码质量要求
- **命名规范**: 使用清晰的类名和方法名
- **注释完整**: 为所有公共方法添加文档注释
- **错误处理**: 使用EasyLoading显示加载和错误状态
- **边界处理**: 处理网络异常、数据为空等边界情况
- **性能优化**: 避免不必要的重建，合理使用Obx

---

## 实现细节

### Entity设计要点
```dart
class TeacherStudentAssignmentEntity {
  // 学生信息
  final String studentUid;
  final String studentName;
  final String studentPhone;
  
  // 作业信息
  final String assignmentId;
  final String assignmentTitle;
  final String status;
  
  // 学习数据
  final int dialogRounds;
  final double knowledgeMasteryScore;
  final double thinkingDepthScore;
  final int avgThinkingTimeMs;
  
  // 时间信息
  final DateTime? startedAt;
  final DateTime? completedAt;
}
```

### Controller核心方法
```dart
class TeacherAssignmentCheckController extends GetxController {
  // 响应式状态
  final assignments = <TeacherStudentAssignmentEntity>[].obs;
  final filteredAssignments = <TeacherStudentAssignmentEntity>[].obs;
  final searchKeyword = ''.obs;
  final selectedStatus = ''.obs;
  final isLoading = false.obs;
  
  // 核心方法
  Future<void> loadAssignments();
  void searchByStudentName(String keyword);
  void filterByStatus(String status);
  void refreshData();
  void loadMoreData();
}
```

### Repository API调用
```dart
class TeacherAssignmentCheckRepository {
  Future<List<TeacherStudentAssignmentEntity>> getTeacherStudentAssignments(String teacherUid) async {
    // 调用API并扁平化数据结构
    // 返回所有学生的作业记录列表
  }
}
```

---

## 验收标准

### 功能验收
- [ ] 能够正确获取并展示老师名下学生作业记录
- [ ] 搜索功能能够按学生姓名进行实时筛选
- [ ] 状态筛选功能正常工作
- [ ] 分页加载功能正常，每页显示20条记录
- [ ] 下拉刷新和上拉加载功能正常
- [ ] 所有评分和时间数据正确格式化显示

### 技术验收  
- [ ] 代码结构清晰，符合DDD架构规范
- [ ] GetX状态管理使用得当，没有内存泄漏
- [ ] API调用正确，错误处理完善
- [ ] UI界面美观，符合设计规范
- [ ] 单元测试覆盖主要业务逻辑

### 用户体验验收
- [ ] 页面加载速度快，交互流畅
- [ ] 搜索响应及时，结果准确
- [ ] 错误提示友好，引导明确
- [ ] 数据展示清晰，重点信息突出

---

## 注意事项

### 数据处理特殊情况
- **空数据处理**: 学生可能没有作业记录 (assignments为空数组)
- **数据类型转换**: 评分字段从字符串转换为数字类型
- **时间格式化**: RFC3339时间格式的本地化显示
- **状态枚举**: 确保所有状态值都有对应的UI展示

### 权限和安全
- **权限验证**: 确保只有老师角色可以访问此功能
- **数据范围**: 验证老师只能查看自己名下的学生作业记录
- **令牌管理**: 复用现有的JWT认证机制

### 性能优化建议
- **分页策略**: 合理使用分页，避免一次性加载过多数据
- **搜索防抖**: 实现搜索防抖，避免频繁触发搜索请求
- **缓存机制**: 考虑实现本地缓存，减少重复网络请求
- **骨架屏**: 添加骨架屏提升加载体验

### 测试覆盖
- **单元测试**: Controller业务逻辑测试
- **Widget测试**: 搜索和筛选交互测试
- **集成测试**: API调用和数据流转测试
- **边界测试**: 网络异常、空数据等边界情况测试