# ğŸš€ Rust + Tokio åç«¯æœåŠ¡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–‡æ¡£

> **ç”Ÿæˆæ—¶é—´**: 2025-08-13  
> **é¡¹ç›®**: qiqimanyou_server  
> **æ¶æ„**: linux/amd64  
> **æœåŠ¡å™¨**: è…¾è®¯äº‘ Ubuntu 22.04  

## ğŸ“‹ éƒ¨ç½²æ¦‚è§ˆ

### ğŸ¯ éƒ¨ç½²ç›®æ ‡
- **åç«¯æœåŠ¡**: Rust + Tokio (Axum)
- **æ•°æ®åº“**: PostgreSQL 15
- **ç¼“å­˜**: Redis 7 (å¯é€‰)
- **åå‘ä»£ç†**: Nginx (å‰ç«¯å·²é…ç½®)

### ğŸ—ï¸ æ¶æ„è®¾è®¡
```
Internet â†’ Nginx (å‰ç«¯) â†’ qiqimanyou-server â†’ PostgreSQL
                     â†˜ Redis (å¯é€‰)
```

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰
```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x backend/deploy_all.sh

# æ‰§è¡Œä¸€é”®éƒ¨ç½²
./backend/deploy_all.sh
```

### 2. åˆ†æ­¥éƒ¨ç½²

#### æ­¥éª¤ 1ï¼šæ„å»ºé•œåƒ
```bash
chmod +x backend/build_image.sh
./backend/build_image.sh
```

#### æ­¥éª¤ 2ï¼šéƒ¨ç½²åˆ°æœåŠ¡å™¨
```bash
chmod +x backend/deploy_to_server.sh
./backend/deploy_to_server.sh
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
backend/
â”œâ”€â”€ Dockerfile                 # å¤šé˜¶æ®µæ„å»ºæ–‡ä»¶
â”œâ”€â”€ docker-compose.yml         # æœåŠ¡ç¼–æ’é…ç½®
â”œâ”€â”€ .env.production            # ç”Ÿäº§ç¯å¢ƒå˜é‡
â”œâ”€â”€ build_image.sh             # é•œåƒæ„å»ºè„šæœ¬
â”œâ”€â”€ deploy_to_server.sh        # æœåŠ¡å™¨éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ deploy_all.sh              # ä¸€é”®éƒ¨ç½²è„šæœ¬
â””â”€â”€ sql/                       # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®
ç¼–è¾‘ `backend/.env.production` æ–‡ä»¶ï¼š

```bash
# æ•°æ®åº“é…ç½®
POSTGRES_PASSWORD=your_secure_password
JWT_SECRET=your_jwt_secret_key

# æœåŠ¡å™¨é…ç½®
SERVER_HOST=82.156.34.186
SERVER_USER=ubuntu
```

### ç½‘ç»œé…ç½®
- **ç½‘ç»œåç§°**: `qiqimanyou-network`
- **åç«¯ç«¯å£**: 8001 (ä»…å†…ç½‘)
- **æ•°æ®åº“ç«¯å£**: 5432 (ä»…å†…ç½‘)
- **Redis ç«¯å£**: 6379 (ä»…å†…ç½‘)

## ğŸ” éƒ¨ç½²éªŒè¯

### 1. å¥åº·æ£€æŸ¥
```bash
curl http://82.156.34.186/health
```

### 2. æœåŠ¡çŠ¶æ€
```bash
ssh ubuntu@82.156.34.186 'cd ~/qisd_eda_college/backend && docker compose ps'
```

### 3. æŸ¥çœ‹æ—¥å¿—
```bash
ssh ubuntu@82.156.34.186 'cd ~/qisd_eda_college/backend && docker compose logs -f'
```

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

### æœåŠ¡ç®¡ç†
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# é‡å¯æœåŠ¡
docker compose restart

# åœæ­¢æœåŠ¡
docker compose down

# å¯åŠ¨æœåŠ¡
docker compose up -d

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker compose logs -f qiqimanyou-server
```

### é•œåƒç®¡ç†
```bash
# æŸ¥çœ‹é•œåƒ
docker images | grep qiqimanyou

# æ¸…ç†æœªä½¿ç”¨é•œåƒ
docker system prune -f

# åˆ é™¤ç‰¹å®šé•œåƒ
docker rmi qiqimanyou-server:latest
```
### ç«¯å£ç®¡ç†

```
lsof -i :8000

kill -9 <PID>

```

## âš ï¸ æ³¨æ„äº‹é¡¹

### ğŸ”’ å®‰å…¨é…ç½®
1. **ä¿®æ”¹é»˜è®¤å¯†ç **: ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ JWT_SECRET å’Œæ•°æ®åº“å¯†ç 
2. **é˜²ç«å¢™è®¾ç½®**: ç¡®ä¿åªå¼€æ”¾å¿…è¦ç«¯å£ (80, 443)
3. **SSL è¯ä¹¦**: å»ºè®®é…ç½® HTTPS (åœ¨å‰ç«¯ Nginx å±‚)

### ğŸ“¦ é•œåƒä¼˜åŒ–
1. **å¤šé˜¶æ®µæ„å»º**: å·²ä½¿ç”¨ builder + runtime æ¨¡å¼
2. **é•œåƒå¤§å°**: ä½¿ç”¨ debian:bookworm-slim åŸºç¡€é•œåƒ
3. **ç¼“å­˜ä¼˜åŒ–**: ä¾èµ–é¡¹å•ç‹¬æ„å»ºï¼Œåˆ©ç”¨ Docker ç¼“å­˜

### ğŸ”§ æ€§èƒ½è°ƒä¼˜
1. **å†…å­˜é™åˆ¶**: å¯åœ¨ docker-compose.yml ä¸­è®¾ç½®å†…å­˜é™åˆ¶
2. **æ—¥å¿—ç®¡ç†**: é…ç½®æ—¥å¿—è½®è½¬é¿å…ç£ç›˜å æ»¡
3. **å¥åº·æ£€æŸ¥**: å·²é…ç½®åº”ç”¨çº§å¥åº·æ£€æŸ¥

### ğŸš¨ æ•…éšœæ’æŸ¥
1. **æ„å»ºå¤±è´¥**: æ£€æŸ¥ Rust ä»£ç ç¼–è¯‘é”™è¯¯
2. **å¯åŠ¨å¤±è´¥**: æŸ¥çœ‹å®¹å™¨æ—¥å¿—æ’æŸ¥é…ç½®é—®é¢˜
3. **ç½‘ç»œé—®é¢˜**: ç¡®è®¤ç½‘ç»œé…ç½®å’Œç«¯å£æ˜ å°„
4. **æ•°æ®åº“è¿æ¥**: æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€å’Œè¿æ¥å­—ç¬¦ä¸²

## ğŸ“Š ç›‘æ§å»ºè®®

### åº”ç”¨ç›‘æ§
- å¥åº·æ£€æŸ¥ç«¯ç‚¹: `/health`
- æŒ‡æ ‡æ”¶é›†: å¯é›†æˆ Prometheus
- æ—¥å¿—èšåˆ: å»ºè®®ä½¿ç”¨ ELK Stack

### èµ„æºç›‘æ§
- CPU/å†…å­˜ä½¿ç”¨ç‡
- ç£ç›˜ç©ºé—´ç›‘æ§
- ç½‘ç»œæµé‡ç›‘æ§

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### ä»£ç æ›´æ–°
```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡æ–°éƒ¨ç½²
./backend/deploy_all.sh
```

### æ•°æ®åº“è¿ç§»
```bash
# å¤‡ä»½æ•°æ®åº“
docker exec qiqimanyou-postgres pg_dump -U qisd edadb > backup.sql

# æ‰§è¡Œè¿ç§»è„šæœ¬
# (æ ¹æ®å…·ä½“è¿ç§»éœ€æ±‚)
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜æ—¶ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. é”™è¯¯æ—¥å¿—: `docker compose logs`
2. æœåŠ¡çŠ¶æ€: `docker compose ps`
3. ç³»ç»Ÿèµ„æº: `free -h && df -h`
4. ç½‘ç»œè¿æ¥: `netstat -tlnp`

---

ğŸ“ **æ–‡æ¡£ç»´æŠ¤**: è¯·åœ¨æ¯æ¬¡é‡å¤§æ›´æ–°ååŒæ­¥æ›´æ–°æ­¤æ–‡æ¡£  
ğŸ”— **ç›¸å…³æ–‡æ¡£**: [API æ–‡æ¡£] | [æ•°æ®åº“è®¾è®¡] | [å‰ç«¯éƒ¨ç½²]
