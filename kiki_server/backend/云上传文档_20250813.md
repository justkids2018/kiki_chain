# ğŸŒ Rust åç«¯æœåŠ¡äº‘ä¸Šä¼ éƒ¨ç½²æŒ‡å—

> **ç”Ÿæˆæ—¶é—´**: 2025-08-13  
> **ç›®æ ‡æœåŠ¡å™¨**: 82.156.34.186 (è…¾è®¯äº‘)  
> **éƒ¨ç½²è·¯å¾„**: /home/ubuntu/qisd_eda_college/backend  

## ğŸš€ äº‘ä¸Šä¼ éƒ¨ç½²æµç¨‹

### ğŸ“‹ å‰ç½®æ£€æŸ¥

#### 1. æœ¬åœ°ç¯å¢ƒæ£€æŸ¥
```bash
# æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œ
docker --version
docker compose --version

# æ£€æŸ¥é¡¹ç›®æ–‡ä»¶
ls -la backend/
cat backend/.env.production
```

#### 2. æœåŠ¡å™¨è¿æ¥æ£€æŸ¥
```bash
# æµ‹è¯• SSH è¿æ¥
ssh ubuntu@82.156.34.186 "echo 'è¿æ¥æˆåŠŸ'"

# æ£€æŸ¥æœåŠ¡å™¨ Docker ç¯å¢ƒ
ssh ubuntu@82.156.34.186 "docker --version && docker compose --version"
```

### ğŸ—ï¸ é•œåƒæ„å»ºå’Œä¸Šä¼ 

#### æ­¥éª¤ 1: æœ¬åœ°æ„å»ºé•œåƒ
```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /path/to/qiqimanyou_server

# æ‰§è¡Œæ„å»ºè„šæœ¬
chmod +x backend/build_image.sh
./backend/build_image.sh

# éªŒè¯æ„å»ºç»“æœ
ls -lh backend/qiqimanyou-server-linux-amd64.tar.gz
```

**æ„å»ºè¿‡ç¨‹è¯´æ˜:**
- âœ… å¤šé˜¶æ®µæ„å»º (builder + runtime)
- âœ… å¼ºåˆ¶æŒ‡å®š linux/amd64 æ¶æ„
- âœ… è‡ªåŠ¨å‹ç¼©é•œåƒæ–‡ä»¶
- âœ… ç”Ÿæˆ SHA256 æ ¡éªŒå€¼

#### æ­¥éª¤ 2: ä¸Šä¼ åˆ°æœåŠ¡å™¨
```bash
# æ‰§è¡Œä¸Šä¼ éƒ¨ç½²è„šæœ¬
chmod +x backend/deploy_to_server.sh
./backend/deploy_to_server.sh
```

**ä¸Šä¼ è¿‡ç¨‹è¯´æ˜:**
- ğŸ“¤ ä¸Šä¼ å‹ç¼©é•œåƒæ–‡ä»¶
- ğŸ“¤ ä¸Šä¼  Docker Compose é…ç½®
- ğŸ“¤ ä¸Šä¼ ç¯å¢ƒå˜é‡é…ç½®
- ğŸ”„ è‡ªåŠ¨æ‰§è¡ŒæœåŠ¡å™¨ç«¯éƒ¨ç½²

### ğŸ–¥ï¸ æœåŠ¡å™¨ç«¯æ“ä½œ

#### è‡ªåŠ¨æ‰§è¡Œçš„æ“ä½œ
```bash
# åœ¨æœåŠ¡å™¨ä¸Šè‡ªåŠ¨æ‰§è¡Œçš„å‘½ä»¤
cd /home/ubuntu/qisd_eda_college/backend

# 1. è§£å‹é•œåƒ
gunzip -f qiqimanyou-server-linux-amd64.tar.gz

# 2. åŠ è½½é•œåƒ
docker load < qiqimanyou-server-linux-amd64.tar

# 3. åœæ­¢æ—§æœåŠ¡
docker compose down

# 4. å¯åŠ¨æ–°æœåŠ¡
docker compose --env-file .env up -d

# 5. æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker compose ps
```

#### æ‰‹åŠ¨éªŒè¯æ“ä½œ
```bash
# SSH ç™»å½•æœåŠ¡å™¨
ssh ubuntu@82.156.34.186

# åˆ‡æ¢åˆ°éƒ¨ç½²ç›®å½•
cd /home/ubuntu/qisd_eda_college/backend

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker compose logs -f qiqimanyou-server

# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8001/health
```

## ğŸ” éƒ¨ç½²éªŒè¯

### 1. æœåŠ¡çŠ¶æ€æ£€æŸ¥
```bash
# æœ¬åœ°æµ‹è¯• (é€šè¿‡å…¬ç½‘)
curl http://82.156.34.186/health

# é¢„æœŸå“åº”
{
  "status": "healthy",
  "timestamp": "2025-08-13T10:30:00Z",
  "version": "1.0.0"
}
```

### 2. å®¹å™¨çŠ¶æ€æ£€æŸ¥
```bash
ssh ubuntu@82.156.34.186 '
  cd /home/ubuntu/qisd_eda_college/backend
  docker compose ps
'

# é¢„æœŸè¾“å‡º
NAME                IMAGE                       STATUS
qiqimanyou-backend  qiqimanyou-server:latest   Up 2 minutes (healthy)
qiqimanyou-postgres postgres:15-alpine         Up 2 minutes (healthy)
qiqimanyou-redis    redis:7-alpine             Up 2 minutes (healthy)
```

### 3. ç½‘ç»œè¿æ¥æ£€æŸ¥
```bash
# æ£€æŸ¥ç½‘ç»œé…ç½®
ssh ubuntu@82.156.34.186 '
  docker network ls | grep qiqimanyou
  docker network inspect qiqimanyou-network
'
```

## ğŸ“Š ä¸Šä¼ æ€§èƒ½æŒ‡æ ‡

### å…¸å‹ä¸Šä¼ æ—¶é—´
| é•œåƒå¤§å° | ç½‘ç»œç¯å¢ƒ | ä¸Šä¼ æ—¶é—´ |
|---------|----------|----------|
| ~200MB  | å®¶åº­å®½å¸¦ | 3-5åˆ†é’Ÿ  |
| ~200MB  | ä¼ä¸šç½‘ç»œ | 1-2åˆ†é’Ÿ  |
| ~200MB  | äº‘å†…ç½‘ç»œ | 30-60ç§’  |

### ä¼˜åŒ–å»ºè®®
1. **å·®é‡æ›´æ–°**: ä½¿ç”¨ Docker é•œåƒå±‚ç¼“å­˜
2. **å‹ç¼©ä¸Šä¼ **: å·²å¯ç”¨ gzip å‹ç¼©
3. **å¹¶è¡Œä¸Šä¼ **: å¯è€ƒè™‘ä½¿ç”¨ rsync åŒæ­¥

## ğŸš¨ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### 1. é•œåƒæ„å»ºå¤±è´¥
```bash
# é—®é¢˜: Rust ç¼–è¯‘é”™è¯¯
# è§£å†³: æ£€æŸ¥æºä»£ç è¯­æ³•é”™è¯¯

# é—®é¢˜: ä¾èµ–ä¸‹è½½å¤±è´¥
# è§£å†³: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæˆ–ä½¿ç”¨é•œåƒæº
```

#### 2. ä¸Šä¼ è¿æ¥å¤±è´¥
```bash
# é—®é¢˜: SSH è¿æ¥è¶…æ—¶
# è§£å†³: æ£€æŸ¥æœåŠ¡å™¨ç½‘ç»œå’Œé˜²ç«å¢™

# é—®é¢˜: SCP ä¼ è¾“ä¸­æ–­
# è§£å†³: ä½¿ç”¨ rsync æ›¿ä»£ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 
rsync -avz --progress backend/qiqimanyou-server-linux-amd64.tar.gz ubuntu@82.156.34.186:~/qisd_eda_college/backend/
```

#### 3. æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥å®¹å™¨æ—¥å¿—
ssh ubuntu@82.156.34.186 '
  cd /home/ubuntu/qisd_eda_college/backend
  docker compose logs qiqimanyou-server
'

# å¸¸è§åŸå› :
# - æ•°æ®åº“è¿æ¥å¤±è´¥
# - ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯
# - ç«¯å£å†²çª
# - å¥åº·æ£€æŸ¥å¤±è´¥
```

#### 4. å¥åº·æ£€æŸ¥å¤±è´¥
```bash
# æ£€æŸ¥åº”ç”¨æ—¥å¿—
docker compose logs qiqimanyou-server

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep 8001

# æ‰‹åŠ¨æµ‹è¯•å¥åº·æ£€æŸ¥
curl -v http://localhost:8001/health
```

## ğŸ”„ å›æ»šæ“ä½œ

### å¿«é€Ÿå›æ»š
```bash
# åœæ­¢å½“å‰æœåŠ¡
ssh ubuntu@82.156.34.186 '
  cd /home/ubuntu/qisd_eda_college/backend
  docker compose down
'

# åŠ è½½ä¹‹å‰çš„é•œåƒ
ssh ubuntu@82.156.34.186 '
  docker images | grep qiqimanyou-server
  docker tag qiqimanyou-server:previous qiqimanyou-server:latest
  cd /home/ubuntu/qisd_eda_college/backend
  docker compose up -d
'
```

### å¤‡ä»½ç­–ç•¥
```bash
# éƒ¨ç½²å‰å¤‡ä»½å½“å‰é•œåƒ
ssh ubuntu@82.156.34.186 '
  docker tag qiqimanyou-server:latest qiqimanyou-server:backup-$(date +%Y%m%d-%H%M%S)
'

# å¤‡ä»½æ•°æ®åº“
ssh ubuntu@82.156.34.186 '
  docker exec qiqimanyou-postgres pg_dump -U qisd edadb > /tmp/backup-$(date +%Y%m%d-%H%M%S).sql
'
```

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—ç®¡ç†
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
ssh ubuntu@82.156.34.186 '
  cd /home/ubuntu/qisd_eda_college/backend
  docker compose logs -f --tail=100
'

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker compose logs qiqimanyou-server
docker compose logs postgres
docker compose logs redis
```

### æ€§èƒ½ç›‘æ§
```bash
# å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
docker stats qiqimanyou-backend

# ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
ssh ubuntu@82.156.34.186 '
  top
  free -h
  df -h
'
```

## ğŸ›¡ï¸ å®‰å…¨æœ€ä½³å®è·µ

### 1. SSH å¯†é’¥ç®¡ç†
```bash
# ç¡®ä¿ä½¿ç”¨ SSH å¯†é’¥è€Œéå¯†ç 
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
ssh-copy-id ubuntu@82.156.34.186
```

### 2. æœåŠ¡å™¨å®‰å…¨
```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
ssh ubuntu@82.156.34.186 'ufw status'

# åªå¼€æ”¾å¿…è¦ç«¯å£
ssh ubuntu@82.156.34.186 '
  ufw allow 22/tcp
  ufw allow 80/tcp
  ufw allow 443/tcp
  ufw enable
'
```

# ç«¯å£è¢«å 

```
  lsof -i :8081
  kill -9 12345
```

### 3. å®¹å™¨å®‰å…¨
- âœ… ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œå®¹å™¨
- âœ… å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ
- âœ… æ‰«æé•œåƒå®‰å…¨æ¼æ´
- âœ… é™åˆ¶å®¹å™¨èµ„æºä½¿ç”¨

## ğŸ¯ ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] æœ¬åœ°é•œåƒæ„å»ºæˆåŠŸ
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] SSH è¿æ¥æ­£å¸¸
- [ ] æœåŠ¡å™¨ç£ç›˜ç©ºé—´å……è¶³
- [ ] æ•°æ®åº“å¤‡ä»½å®Œæˆ

### éƒ¨ç½²åæ£€æŸ¥
- [ ] å¥åº·æ£€æŸ¥ç«¯ç‚¹å“åº”æ­£å¸¸
- [ ] æ‰€æœ‰å®¹å™¨çŠ¶æ€ä¸º healthy
- [ ] æ—¥å¿—æ— é”™è¯¯ä¿¡æ¯
- [ ] API æ¥å£å¯æ­£å¸¸è®¿é—®
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸

### æ€§èƒ½æ£€æŸ¥
- [ ] å“åº”æ—¶é—´åœ¨å¯æ¥å—èŒƒå›´å†…
- [ ] å†…å­˜ä½¿ç”¨ç‡æ­£å¸¸
- [ ] CPU ä½¿ç”¨ç‡æ­£å¸¸
- [ ] ç£ç›˜ I/O æ­£å¸¸

---

ğŸ“ **æœ€åæ›´æ–°**: 2025-08-13  
ğŸ”— **ç›¸å…³æ–‡æ¡£**: [éƒ¨ç½²æ–‡æ¡£](éƒ¨ç½²æ–‡æ¡£_20250813.md) | [API æ–‡æ¡£] | [ç›‘æ§æ–‡æ¡£]  
ğŸ“ **æŠ€æœ¯æ”¯æŒ**: é‡åˆ°é—®é¢˜è¯·å‚è€ƒæ•…éšœæ’æŸ¥ç« èŠ‚æˆ–è”ç³»æŠ€æœ¯å›¢é˜Ÿ
