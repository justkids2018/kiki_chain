# æ—¥å¿—é‡å¤é—®é¢˜åˆ†æå’Œä¼˜åŒ–æ–¹æ¡ˆ

## é—®é¢˜åˆ†æ

æ‚¨é‡åˆ°çš„ `get_teacher_assignments` é‡å¤æ—¥å¿—é—®é¢˜æºäºå¤šå±‚æ—¥å¿—è®°å½•ï¼š

### å½“å‰æ—¥å¿—å±‚æ¬¡ç»“æ„
```
ğŸ“¥ [REQUEST] ä¸­é—´ä»¶å±‚    â† HTTPè¯·æ±‚è¯¦ç»†ä¿¡æ¯ (headers, body, etc.)
ğŸ“‹ [ä½œä¸šåˆ—è¡¨] è·¯ç”±å±‚      â† åŠŸèƒ½å…¥å£æ—¥å¿—
ğŸ” [ä½œä¸šåˆ—è¡¨] è·¯ç”±å±‚      â† Tokenæå–æ—¥å¿—  
ğŸ“‹ [ä¸šåŠ¡å±‚] æ§åˆ¶å™¨å±‚      â† ä¸šåŠ¡é€»è¾‘å¼€å§‹
âœ… [ä¸šåŠ¡å±‚] æ§åˆ¶å™¨å±‚      â† ä¸šåŠ¡ç»“æœ
ğŸ“¤ [RESPONSE] ä¸­é—´ä»¶å±‚   â† HTTPå“åº”è¯¦ç»†ä¿¡æ¯
```

### é‡å¤åŸå› 
1. **ä¸­é—´ä»¶å±‚**: è®°å½•HTTPè¯·æ±‚/å“åº”è¯¦ç»†ä¿¡æ¯
2. **è·¯ç”±å±‚**: è®°å½•åŠŸèƒ½å…¥å£å’ŒTokenæå–
3. **æ§åˆ¶å™¨å±‚**: è®°å½•ä¸šåŠ¡é€»è¾‘æ‰§è¡Œ
4. **ç”¨ä¾‹å±‚**: è®°å½•å…·ä½“æ“ä½œï¼ˆå¯èƒ½è¿˜æœ‰æ›´å¤šï¼‰

## ä¼˜åŒ–æ–¹æ¡ˆ

### 1. æ—¥å¿—åˆ†å±‚åŸåˆ™

#### ä¸­é—´ä»¶å±‚ (Infrastructure)
- **èŒè´£**: HTTPåè®®å±‚é¢çš„æŠ€æœ¯æ—¥å¿—
- **å†…å®¹**: è¯·æ±‚IDã€Headersã€æ€§èƒ½æŒ‡æ ‡ã€é”™è¯¯çŠ¶æ€ç 
- **æ ¼å¼**: ç»“æ„åŒ–JSON
```rust
ğŸ“¥ [REQUEST] {"request_id": "uuid", "method": "GET", "path": "/api/teacher/assignments"}
ğŸ“¤ [RESPONSE] {"request_id": "uuid", "status": 200, "duration_ms": 45}
```

#### è·¯ç”±å±‚ (Presentation)
- **èŒè´£**: æœ€å°åŒ–æ—¥å¿—ï¼Œä¸»è¦ç”¨äºè¿½è¸ª
- **å†…å®¹**: ç”¨æˆ·èº«ä»½è¯†åˆ«ï¼ˆtracing spanï¼‰
- **æ ¼å¼**: ç»“æ„åŒ–è¿½è¸ª
```rust
#[instrument(skip(state), fields(teacher_id))]
// é€šè¿‡ tracing::Span::current().record("teacher_id", &id) è®°å½•
```

#### æ§åˆ¶å™¨å±‚ (Application)
- **èŒè´£**: ä¸šåŠ¡çº§åˆ«çš„å…³é”®æ—¥å¿—
- **å†…å®¹**: ä¸šåŠ¡å®ä½“ã€æ“ä½œç»“æœã€ä¸šåŠ¡æ€§èƒ½
- **æ ¼å¼**: ä¸šåŠ¡å‹å¥½
```rust
ğŸ“‹ [ä¸šåŠ¡å±‚] æŸ¥è¯¢ä½œä¸šåˆ—è¡¨ - æ•™å¸ˆ: teacher_123
âœ… [ä¸šåŠ¡å±‚] æŸ¥è¯¢æˆåŠŸ - æ•™å¸ˆ: teacher_123, æ•°é‡: 5, è€—æ—¶: 23ms
```

#### ç”¨ä¾‹å±‚ (Domain)
- **èŒè´£**: é¢†åŸŸé€»è¾‘å…³é”®å†³ç­–ç‚¹
- **å†…å®¹**: ä¸šåŠ¡è§„åˆ™éªŒè¯ã€é¢†åŸŸäº‹ä»¶
- **æ ¼å¼**: é¢†åŸŸè¯­è¨€
```rust
ğŸ” [é¢†åŸŸå±‚] éªŒè¯æ•™å¸ˆæƒé™ - teacher_123
âœ… [é¢†åŸŸå±‚] æƒé™éªŒè¯é€šè¿‡
```

### 2. ä¼˜åŒ–åçš„å®ç°

#### è·¯ç”±å±‚ - æœ€å°åŒ–æ—¥å¿—
```rust
#[instrument(skip(state), fields(teacher_id))]
async fn get_teacher_assignments(
    State(state): State<AppState>,
    headers: HeaderMap,
) -> Result<Json<ApiResponse<Value>>, axum::http::StatusCode> {
    // é™é»˜æå–ç”¨æˆ·IDï¼Œé€šè¿‡tracingè®°å½•
    let teacher_id = HttpUtils::extract_user_id_from_headers(&headers)
        .map_err(|_| axum::http::StatusCode::UNAUTHORIZED)?;
    
    // è®°å½•åˆ°tracing span
    tracing::Span::current().record("teacher_id", &teacher_id);
    
    // ç›´æ¥è°ƒç”¨æ§åˆ¶å™¨ï¼Œè®©ä¸šåŠ¡å±‚è´Ÿè´£æ—¥å¿—
    state.assignment_controller.list_assignments(teacher_id, None).await
        .map(Json)
        .map_err(|_| axum::http::StatusCode::INTERNAL_SERVER_ERROR)
}
```

#### æ§åˆ¶å™¨å±‚ - ä¸šåŠ¡å…³é”®æ—¥å¿—
```rust
pub async fn list_assignments(&self, teacher_id: String, status: Option<String>) -> Result<ApiResponse<Value>> {
    let start_time = Instant::now();
    
    // åªè®°å½•ä¸šåŠ¡å…³é”®ä¿¡æ¯
    Logger::info(format!("ğŸ“‹ [ä¸šåŠ¡] æŸ¥è¯¢ä½œä¸šåˆ—è¡¨ - æ•™å¸ˆ: {}", teacher_id));
    
    let response = self.list_use_case.execute(query).await?;
    
    // è®°å½•ä¸šåŠ¡ç»“æœå’Œæ€§èƒ½
    Logger::info(format!("âœ… [ä¸šåŠ¡] æŸ¥è¯¢æˆåŠŸ - æ•™å¸ˆ: {}, æ•°é‡: {}, è€—æ—¶: {}ms", 
        teacher_id, response.assignments.len(), start_time.elapsed().as_millis()));
    
    Ok(ApiResponse::success(serde_json::to_value(response)?, "æŸ¥è¯¢æˆåŠŸ"))
}
```

### 3. æ—¥å¿—é…ç½®ä¼˜åŒ–

#### ç¯å¢ƒé…ç½®
```toml
# config/development.toml
[logging]
level = "debug"
# å¼€å‘ç¯å¢ƒæ˜¾ç¤ºæ‰€æœ‰å±‚æ¬¡æ—¥å¿—

# config/production.toml  
[logging]
level = "info"
# ç”Ÿäº§ç¯å¢ƒåªæ˜¾ç¤ºä¸šåŠ¡å’Œé”™è¯¯æ—¥å¿—
```

#### æ¨¡å—çº§åˆ«æ§åˆ¶
```rust
// å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶ç‰¹å®šæ¨¡å—çš„æ—¥å¿—çº§åˆ«
RUST_LOG="qiqimanyou_server::presentation::http=warn,qiqimanyou_server::app::routes=info"
```

### 4. å®é™…æ•ˆæœå¯¹æ¯”

#### ä¼˜åŒ–å‰ (é‡å¤å†—ä½™)
```
ğŸ“¥ [REQUEST] {"method": "GET", "path": "/api/teacher/assignments", ...}
ğŸ“‹ [ä½œä¸šåˆ—è¡¨] è·å–è€å¸ˆä½œä¸šåˆ—è¡¨
ğŸ” [ä½œä¸šåˆ—è¡¨] ä»tokenæå–åˆ°teacher_id: teacher_123
ğŸ“‹ [ä¸šåŠ¡å±‚] å¼€å§‹å¤„ç†è·å–ä½œä¸šåˆ—è¡¨è¯·æ±‚ - è€å¸ˆID: teacher_123
ğŸ“‹ [ä¸šåŠ¡å±‚] ä½œä¸šåˆ—è¡¨è·å–æˆåŠŸ - è€å¸ˆID: teacher_123, ä½œä¸šæ•°é‡: 5
âœ… [ä½œä¸šåˆ—è¡¨] æ•™å¸ˆ teacher_123 æˆåŠŸè·å–ä½œä¸šåˆ—è¡¨
ğŸ“¤ [RESPONSE] {"status": 200, "duration_ms": 45}
```

#### ä¼˜åŒ–å (ç®€æ´é«˜æ•ˆ)
```
ğŸ“¥ [REQUEST] {"method": "GET", "path": "/api/teacher/assignments", "teacher_id": "teacher_123"}
ğŸ“‹ [ä¸šåŠ¡] æŸ¥è¯¢ä½œä¸šåˆ—è¡¨ - æ•™å¸ˆ: teacher_123
âœ… [ä¸šåŠ¡] æŸ¥è¯¢æˆåŠŸ - æ•™å¸ˆ: teacher_123, æ•°é‡: 5, è€—æ—¶: 23ms
ğŸ“¤ [RESPONSE] {"status": 200, "duration_ms": 45}
```

## å®æ–½å»ºè®®

### ç«‹å³è¡ŒåŠ¨
1. âœ… **è·¯ç”±å±‚å»é‡**: ç§»é™¤è·¯ç”±å±‚çš„è¯¦ç»†ä¸šåŠ¡æ—¥å¿—
2. âœ… **æ§åˆ¶å™¨ä¼˜åŒ–**: ç²¾ç®€æ§åˆ¶å™¨å±‚æ—¥å¿—ï¼Œä¸“æ³¨ä¸šåŠ¡å…³é”®ä¿¡æ¯
3. ğŸ”„ **tracingæ•´åˆ**: ä½¿ç”¨tracing spanä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯

### é•¿æœŸä¼˜åŒ–
1. **æ—¥å¿—æ ‡å‡†åŒ–**: å»ºç«‹å„å±‚æ—¥å¿—è§„èŒƒ
2. **æ€§èƒ½ç›‘æ§**: é›†æˆAPMå·¥å…·æ›¿ä»£æ€§èƒ½æ—¥å¿—
3. **æ—¥å¿—èšåˆ**: ä½¿ç”¨ELK/Lokiç­‰å·¥å…·èšåˆåˆ†æ

### ç›‘æ§æŒ‡æ ‡
- å‡å°‘80%çš„é‡å¤æ—¥å¿—
- æå‡æ—¥å¿—å¯è¯»æ€§
- ä¿æŒè°ƒè¯•èƒ½åŠ›
- é™ä½å­˜å‚¨æˆæœ¬

è¿™æ ·ä¼˜åŒ–åï¼Œæ¯ä¸ªè¯·æ±‚çš„æ—¥å¿—ä¼šæ›´åŠ ç®€æ´æ¸…æ™°ï¼Œé¿å…äº†ä¿¡æ¯é‡å¤ï¼ŒåŒæ—¶ä¿æŒäº†å®Œæ•´çš„å¯è¿½è¸ªæ€§ã€‚
